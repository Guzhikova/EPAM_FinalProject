@using DentalOffice.WebUI.Management;
@using DentalOffice.Common;
@using DentalOffice.Entities;
@{
    Layout = "~/Pages/Layouts/_MainLayout.cshtml";

    var adminMod = new AdministrationModule();
    var roleManage = new RolesManagment();

    List<User> users = adminMod.GetUsers();

    string action = Request["action"];
    string activeRole = "";
    int counter = 0;
    int roleId = 0;


    if(action == "addRole")
    {
        Int32.TryParse(Request["addRoleId"], out roleId);
        Role role = roleManage.GetRoleFromRequest(Request, "addRoleId");
        activeRole = $"Выбор пользователя для роли{role.Title}";
    }
}


<div class="table-responsive">
    <h4 class="text-center my-3">Зарегистрированные пользователи</h4>
    <table class="table table-hover">
        <thead>
            <tr>
                <th class="text-secondary">#</th>
                <th>Логин</th>
                <th>Email</th>
                <th>Дата регистрации</th>
                <th>Зарегистрирован как</th>
                <th>Роли</th>
                <th class="text-danger">@activeRole</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in users)
            {
            <tr>
                <th class="text-secondary">@(++counter)</th>
                <th>@user.Login</th>
                <td class="small">@user.Email</td>
                <td class="small">@user.RegistrationDate.ToString("s")</td>

                <td class="small">
                    @if (user.PatientData != null)
                    {
                        <text>
                            Пациент:  @user.PatientData.ToString()
                        </text>
                    }

                </td>
                <td class="small">
                    @if (user.Roles != null)
                    {
                        foreach (var role in user.Roles)
                        {
                            @role.Title<br>
                        }
                    }
                </td>
                @if (action == "addRole")
                {
                    <td>
                        <a href="~/Pages/Admin/RoleManagement?action=addUser&userId=@user.ID&roleId=@roleId" title="Удалить">Добавить роль</a><text>&#8195;</text>
                    </td>
                }
                else
                {
                    <td>
                        <a  href="~/Pages/Confirmation?entity=user&id=@user.ID" title="Удалить"> <img class="img-icon w-25 h-25" src="~/Content/Images/delete.svg"></a><text>&#8195;</text>
                        <a href="~/Pages/UserEditor?action=edit&id=@user.ID" title="Редактировать"> <img class="img-icon w-25 h-25" src="~/Content/Images/edit.svg"></a>
                    </td>
                }
            </tr>
            }


        </tbody>
    </table>
</div>